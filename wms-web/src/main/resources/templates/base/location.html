<!DOCTYPE html>
<html xmlns:wms="http://www.w3.org/1999/xhtml">
<head>
    <title wms:text="${wms.location.title}">库位</title>
    <head th:replace="common/head">
    </head>
<body class="easyui-layout" >
<div data-options="region:'west',collapsible:true" wms:title="${web.label.search.title}" style="width:200px;">
    <div id="searchDiv">
        <div style="margin-left: 10px;">
            <form id="searchForm" data-table="#dataTable" >
                <div style="margin-bottom:10px">
                    <input name="locationCode" class="easyui-textbox" wms:data-options="label:'${web.label.location}',labelPosition:'top'">
                </div>
                <div style="margin-bottom:10px">
                    <input class="easyui-combobox" name="locationType" wms:data-options="
						data: codelkups['LOCATIONTYPE'],
						valueField: 'code',
						textField: 'descr',
						label: '${web.label.location.locationType}',
						labelPosition: 'top'
						">
                </div>
                <div style="margin-bottom:10px">
                    <input name="zoneCode" class="easyui-textbox" wms:data-options="label:'${web.label.zone}',labelPosition:'top'">
                </div>
                <div style="margin-bottom:10px">
                    <input class="easyui-combobox" name="skuMix" wms:data-options="
						data: codelkups['YESNO'],
						valueField: 'code',
						textField: 'descr',
						label: '${web.label.location.skuMix}',
						labelPosition: 'top'
						">
                </div>
                <div style="margin-bottom:10px">
                    <input class="easyui-combobox" name="lotMix" wms:data-options="
						data: codelkups['YESNO'],
						valueField: 'code',
						textField: 'descr',
						label: '${web.label.location.lotMix}',
						labelPosition: 'top'
						">
                </div>
                <div style="margin-bottom:10px">
                    <input class="easyui-combobox" name="active" wms:data-options="
						data: codelkups['YESNO'],
						valueField: 'code',
						textField: 'descr',
						label: '${web.label.active}',
						labelPosition: 'top'
						">
                </div>
            </form>
        </div>
        <div style="text-align: center;">
            <a href="#" class="easyui-linkbutton common-search" data-form="#searchForm" style="width:80px;" data-options="iconCls:'icon-search'" >
                <span wms:text="${web.label.search}">Search</span>
            </a>
            <a href="#" class="easyui-linkbutton common-search-clear" data-form="#searchForm" style="width:80px;" data-options="iconCls:'icon-clear'" >
                <span wms:text="${web.label.clear}">Clear</span>
            </a>
        </div>
    </div>
</div>
<div data-options="region:'center',border:false" >
    <div id="dataTableToolbar" style="padding-left: 20px;">
        <a href="#" class="easyui-linkbutton common-add" data-addpanel="#addDiv">
            <span wms:text="${web.label.add}">Add</span>
        </a>
        <a href="#" class="easyui-linkbutton common-rowsave" data-table="#dataTable" th:data-url="@{/services/inner/base/location/save}" >
            <span wms:text="${web.label.save}">Save</span>
        </a>
        <a href="#" class="easyui-linkbutton" onclick="locationPrint()" wms:text="${web.label.print}">Print</a>
        <a href="#" class="easyui-linkbutton" onclick="importExcel('LOCATION')" wms:text="${web.label.import}">Import</a>
        <a href="#" class="easyui-linkbutton" onclick="exportExcel('LOCATION', '#searchForm')" wms:text="${web.label.export}">Export</a>
        <a href="#" class="easyui-linkbutton common-rowdel"  data-table="#dataTable" th:data-url="@{/services/inner/base/location/delete}">
            <span wms:text="${web.label.delete}">Delete</span>
        </a>
    </div>
    <div>
        <table id="dataTable" wms:title="${web.label.location.title}" class="easyui-datagrid"
               th:data-delayUrl="@{/services/inner/base/location/find}">
            <thead>
            <tr>
                <th field="locationId" data-options="checkbox:true"></th>
                <th field="locationCode" width="130" wms:text="${web.label.location}" data-options="
                            sortable:true">locationCode</th>
                <th field="locationType" width="150" wms:text="${web.label.location.locationType}" data-options="
                            sortable:true,
                            formatter:function(value,row){
								return getCodelkupValue('LOCATIONTYPE',value);
							},
                            editor:{
								type:'combobox',
								options:{
									valueField:'code',
									textField:'descr',
									data: codelkups['LOCATIONTYPE']
								}
							}
                        ">locationType</th>
                <th field="locationLogical" width="150" wms:text="${web.label.location.locationLogical}" data-options="sortable:true,editor:'text'">locationLogical</th>
                <th field="zoneCode" width="150" wms:text="${web.label.zone}" wms:data-options="
							sortable:true,
							editor:{
								type:'combogrid',
								options:{
									idField:'zoneCode',
	    							textField:'zoneCode',
									url:'../../services/inner/base/zone/find',
									queryParams: getZoneParams(),
								    columns:[[
									    {field:'zoneId',hidden:true},
								        {field:'zoneCode',title:'${web.label.code}',width:150}
								    ]]
								}
							}

						">zoneCode</th>
                <th field="x" width="70" data-options="sortable:true,editor:'numberbox'">X</th>
                <th field="y" width="70" data-options="sortable:true,editor:'numberbox'">Y</th>
                <th field="z" width="70" data-options="sortable:true,editor:'numberbox'">Z</th>
                <th field="skuMix" width="70" wms:text="${web.label.location.skuMix}" data-options="
							sortable:true,
							formatter:function(value,row){
								return getCodelkupValue('YESNO',value);
							},
							editor:{
								type:'combobox',
								options:{
									valueField:'code',
									textField:'descr',
									data: codelkups['YESNO']
								}
							}
						" >skuMix</th>
                <th field="lotMix" width="70" wms:text="${web.label.location.lotMix}" data-options="
							sortable:true,
							formatter:function(value,row){
								return getCodelkupValue('YESNO',value);
							},
							editor:{
								type:'combobox',
								options:{
									valueField:'code',
									textField:'descr',
									data: codelkups['YESNO']
								}
							}
						" >lotMix</th>
                <th field="active" width="50" wms:text="${web.label.active}" data-options="
							sortable:true,
							formatter:function(value,row){
								return getCodelkupValue('YESNO',value);
							},
							editor:{
								type:'combobox',
								options:{
									valueField:'code',
									textField:'descr',
									data: codelkups['YESNO']
								}
							}
						" >active</th>
                <th field="createBy" width="80" wms:text="${web.label.createby}">createBy</th>
                <th field="createTime" width="150" wms:text="${web.label.createtime}"  data-options="sortable:true">createTime</th>
                <th field="updateBy" width="80" wms:text="${web.label.updateby}" >updateBy</th>
                <th field="updateTime" width="150" wms:text="${web.label.updatetime}" data-options="sortable:true">updateTime</th>
            </tr>
            </thead>
        </table>
    </div>
</div>
<div id="addDiv" wms:title="${web.label.add}" style="width:450px;height:450px; display: none;">
    <div style="width: 100%;padding-left: 50px;">
        <form method="post" id="addForm" th:data-url="@{/services/inner/base/location/add}">
            <table style="width: 100%;">
                <tr>
                    <td >
                        <input id="locationCode" name="locationCode" class="easyui-textbox" wms:data-options="
                        	required:true,
                        	label:'${web.label.location}',
                        	labelPosition:'top',
                        	validType:'characterNumber'">
                    </td>
                    <td >
                        <input class="easyui-combobox" name="locationType"  style="width: 100px;"  wms:data-options="
							required:true,
							data: codelkups['LOCATIONTYPE'],
							valueField: 'code',
							textField: 'descr',
							label: '${web.label.type}',
							labelPosition: 'top'
							" />
                    </td>
                </tr>
                <tr>
                    <td >
                        <input id="locationLogical" name="locationLogical" class="easyui-textbox" wms:data-options="required:true,label:'${web.label.location.locationLogical}',labelPosition:'top',validType:'characterNumber'">
                    </td>
                    <td >
                       <input name="zonecode" th:replace="lov/zone" />
						<input type="hidden" name="zoneId" id="zoneId" />
                    </td>
                </tr>
                <tr>
                    <td>
                        <input name="x" class="easyui-numberbox" wms:data-options="required:true,label:'X',value: '0',labelPosition:'top'">
                    </td>
                    <td >
                        <input name="y" class="easyui-numberbox" style="width: 132px;" wms:data-options="required:true,value: '0',label:'Y',labelPosition:'top'">
                    </td>
                </tr>
                <tr>
                    <td>
                        <input name="z" class="easyui-numberbox" wms:data-options="required:true,label:'Z',value: '0',labelPosition:'top'">
                    </td>
                    <td >
                        <input class="easyui-combobox" name="skuMix"  wms:data-options="
							required:true,
							value: 'Y',
							data: codelkups['YESNO'],
							valueField: 'code',
							textField: 'descr',
							label: '${web.label.location.skuMix}',
							labelPosition: 'top'
							" />
                    </td>
                </tr>
                <tr>
                    <td>
                        <input class="easyui-combobox" name="lotMix"  wms:data-options="
							required:true,
							value: 'Y',
							data: codelkups['YESNO'],
							valueField: 'code',
							textField: 'descr',
							label: '${web.label.location.lotMix}',
							labelPosition: 'top'
							" />
                    </td>
                    <td >
                        <input class="easyui-combobox" name="active"  wms:data-options="
							required:true,
							value: 'Y',
							data: codelkups['YESNO'],
							valueField: 'code',
							textField: 'descr',
							label: '${web.label.active}',
							labelPosition: 'top'
							" />
                    </td>
                </tr>
            </table>
        </form>
    </div>
    <div style="text-align: center;margin-top: 30px;">
        <a href="#" class="easyui-linkbutton common-confirmadd" data-form="#addForm" data-table="#dataTable" id="submitaddForm" data-options="iconCls:'icon-ok'" style="padding:5px 0px;width:80px;">
            <span style="font-size:14px;" wms:text="${web.label.save}">Save</span>
        </a>
        <a href="#" class="easyui-linkbutton" id="clearAddForm" onclick="$('#addForm').form('clear');" data-options="iconCls:'icon-clear'" style="padding:5px 0px;width:80px;">
            <span style="font-size:14px;" wms:text="${web.label.clear}">Clear</span>
        </a>
    </div>
</div>
</div>
</body>
<script th:replace="common/js" />
<script type="text/javascript" th:src="@{/js/codelkupList?listName=YESNO,LOCATIONTYPE,ZONETYPE}"></script>
<script type="text/javascript" th:inline="text">
   $(function(){
	   $('#zoneCode').combogrid({required:true});
	   $('#locationCode').textbox({
	   		onChange: function(newValue, oldValue){
	   			var value = $('#locationLogical').textbox('getValue');
	   			if (value == ''){
	   				$('#locationLogical').textbox('setValue', newValue);
	   			}
	   		}
	   	});
   });
   
   function locationPrint(){
	   debugger;
	   var data = $('#searchForm').serializeObject();
	   if (data.zoneCode == ''
			   && data.locationCode == ''){
		   confirmMsg($.locale.locationprintall, function(r){
			   if (!r){
				   return;
			   }
			   p(data.zoneCode, data.locationCode);
		   });
	   }else{
		   p(data.zoneCode, data.locationCode);
	   }
	   
	   function p(zoneCode, locationCode){
		   if (zoneCode != ''){
		   	zoneCode = zoneCode.replace('*', '%');
		   }
		   if (locationCode != ''){
		   	locationCode = locationCode.replace('*', '%');
		   }
		   exportReport({
				fileType: "pdf",
				reportType: 'LOCATION',
				zoneCode: zoneCode,
				locationCode: locationCode
			});
	   }
   }
   
</script>
</html>
