<!DOCTYPE html>
<html>
<head>
    <title wms:text="${web.lable.inventory.move}">库存移动</title>
    <head th:replace="common/head" />
</head>
<body class="easyui-layout" >
	<div data-options="region:'west',collapsible:true" wms:title="${web.label.search.title}" style="width:200px;">
		<div id="searchDiv">
			<div style="margin-left: 10px;">
				<form id="searchForm" data-table="#onhandData" >
					<div style="margin-bottom:10px">
						<input name="ownerCode" class="easyui-textbox" wms:data-options="label:'${web.label.owner}',labelPosition:'top'" />
					</div>
					<div style="margin-bottom:10px">
						<input name="skuCode" class="easyui-textbox" wms:data-options="label:'${web.label.sku}',labelPosition:'top'" />
					</div>
					<div style="margin-bottom:10px">
						<input name="skuAlias" class="easyui-textbox" wms:data-options="label:'${web.label.skualias}',labelPosition:'top'" />
					</div>	
					<div style="margin-bottom:10px">
						<input name="locationCode" class="easyui-textbox" wms:data-options="label:'${web.label.locationcode}',labelPosition:'top'" />
					</div>	
					<div style="margin-bottom:10px">
						<input name="lotNumber" class="easyui-textbox" wms:data-options="label:'${web.label.lotnumber}',labelPosition:'top'" />
					</div>
					<div style="margin-bottom:10px">
						<input name="lpnNumber" class="easyui-textbox" wms:data-options="label:'${web.label.lpnnumber}',labelPosition:'top'" />
					</div>	
				</form>
			</div>
			<div style="text-align: center;">
				<a href="#" class="easyui-linkbutton common-search" data-form="#searchForm" style="width:80px;" data-options="iconCls:'icon-search'" >
					<span wms:text="${web.label.search}">Search</span>
				</a>	
				<a href="#" class="easyui-linkbutton common-search-clear" data-form="#searchForm" style="width:80px;" data-options="iconCls:'icon-clear'" >
					<span wms:text="${web.label.clear}">Clear</span>
				</a>
			</div>
		</div>
	</div>
	<div data-options="region:'center',border:false" >
		<!-- 仅查询，这里去掉界面按钮增删改按钮-->
	    <div class="tableToolbar">
			<a href="#" class="easyui-linkbutton common-rowmove" data-table="#onhandData" th:data-url="@{/services/inner/inventory/onhand/move}" >
				<span wms:text="${web.label.move}">Move</span>
			</a>
			<a href="#" class="easyui-linkbutton common-copy" data-table="#onhandData" th:data-url="@{/services/inner/inventory/onhand/move}" >
				<span wms:text="${web.label.copy}">Copy</span>
			</a>
		</div>
		<div>
			<table id="onhandData" wms:title="${web.label.inventorybalancelist.title}" class="easyui-datagrid"
							th:data-delayUrl="@{/services/inner/inventory/onhand/find}">
				<thead data-options="frozen:true">
					<tr>
						<th field="inventoryOnhandId" data-options="checkbox:true"></th>
				 	</tr>
				 </thead>
				<thead>
					<tr>
						<th field="ownerCode" width="80" wms:text="${web.label.owner}" data-options="sortable:true" >ownerCode</th>
						<th field="skuCode" width="100" wms:text="${web.label.sku}" data-options="sortable:true" >skuCode</th>
						<th field="skuAlias" width="100" wms:text="${web.label.skualias}" data-options="sortable:true" >skuAlias</th>
						<th field="lotNumber" width="100" wms:text="${web.label.lotnumber}">lotNumber</th>
						<th field="locationCode" width="100" wms:text="${web.label.locationcode}">locationCode</th>
						<th field="containerNumber" width="100" wms:text="${web.label.containernumber}" data-options="sortable:true">containerNumber</th>
						<th field="lpnNumber" width="100" wms:text="${web.label.lpnnumber}">lpnNumber</th>
						<th field="quantityOnhand" width="100" wms:text="${web.label.quantity.onhand}">quantityOnhand</th>
						<th field="quantityAllocated" width="100" wms:text="${web.label.quantity.allocated}">quantityAllocated</th>
						<th field="quantityLocked" width="100" wms:text="${web.label.quantity.locked}">quantityLocked</th>
						<th field="quantityAvailable" width="100" wms:text="${web.label.quantity.available}">quantityAvailable</th>
						<th field="toLocationCode" width="100" wms:text="${web.label.tolocationcode}" wms:data-options="
						    editor:{
								type:'combogrid',
								options:{
									idField:'locationCode',
	    							textField:'locationCode',
									url:'../../services/inner/base/location/find',
									queryParams: getBaseData(),
								    columns:[[
									    {field:'locationId',hidden:true},
								        {field:'locationCode',title:'${web.label.code}',width:150},
								        {field:'zoneCode',title:'${web.label.zone}',width:150}
								    ]]
								}
                           }
						   " >toLocationCode</th>
						<th field="toContainerNumber" width="100" wms:text="${web.label.tocontainernumber}" data-options="editor:'text'">toContainerNumber</th>
						<th field="toLpnNumber" width="100" wms:text="${web.label.tolpnnumber}" data-options="editor:'text'">toLpnNumber</th>
						<th field="toQuantity" width="100" wms:text="${web.label.toquantity}" data-options="
								editor:{
									type: 'numberbox',
									options: {
										precision:4
									}
								}">toQuantity</th>
						<th field="createBy" width="80" wms:text="${web.label.createby}" >createBy</th>
						<th field="createTime" width="150" wms:text="${web.label.createtime}" data-options="sortable:true" >createTime</th>
						<th field="updateBy" width="80" wms:text="${web.label.updateby}" >updateBy</th>
						<th field="updateTime" width="150" wms:text="${web.label.updatetime}" data-options="sortable:true">updateTime</th>
					</tr>
				</thead>
			</table>
		</div>
	</div>
	</div>
</body>
<script th:replace="common/js" />
<script type="text/javascript" th:src="@{/js/codelkupList?listName=CONFIGTYPE,YESNO}"></script>
<script type="text/javascript" th:inline="text">

	$(function () {
        
		//移动start
		$('.common-rowmove').click(function(){
	        
			var datagrid = $(this).attr('data-table');
			var url = $(this).attr('data-url');
			
			$(datagrid).datagrid('endCellEdit');
	
			var checkedRows = $(datagrid).datagrid('getChecked');
			if (checkedRows.length == 0) {
				showError($.locale.selectOneRow);
				return;
			}
			var data = getBaseData(checkedRows);
			loading();
			$.post({
				url: url,
				data:data,
				success: function(data){
					data = returnData(data);
					closeLoading();
					if (data.code == '0') {
						showError(data.msg);
						return;
					}
					$(datagrid).datagrid('reload').datagrid('clearChecked');
				}
			});
		});
		//移动end
		
		//移动复制目标库位和LPN
	    $('.common-copy').click(function(){
				var datagrid = $(this).attr('data-table');
				
				//结束界面上的编辑框
				$(datagrid).datagrid('endCellEdit');
				
				var checkedRows = $(datagrid).datagrid('getChecked');
				
				//判断是否选择2行以上记录
				if (checkedRows.length < 2) {
					showError($.locale.selectTwoMoreRows);
					return;
				}
				
				//判断选中的第一行的库位信息是否有录入
				if (checkedRows[0].toLocationCode == null || checkedRows[0].toLocationCode == '') {
					showError($.locale.inputTargetLocation);
					return;
				}
				
				//获取选中记录中的第一条记录的目标库位和LPN循环回填其余记录的目标库位和LPN
				for(var i in checkedRows){
					var rowindex = $('#onhandData').datagrid('getRowIndex',checkedRows[i]);
					$('#onhandData').datagrid('updateRow',{
						index: rowindex,
						row: {
							toLocationCode: checkedRows[0].toLocationCode,
							toContainerNumber: checkedRows[0].toContainerNumber,
							toLpnNumber: checkedRows[0].toLpnNumber,
							toQuantity: checkedRows[0].toQuantity
						}
					});
					
					//编辑的值以高亮展示区别
					var dg = $('#onhandData');
					var opts = dg.datagrid('options');
					var tr = opts.finder.getTr(dg[0], rowindex);
					var cellTd1 = tr.find('td[field="toLocationCode"]');
					var cellTd2 = tr.find('td[field="toLpnNumber"]');
					if(!(checkedRows[i].toLocationCode == null || checkedRows[i].toLocationCode == '')){
						cellTd1.addClass('datagrid-cell-edited');
					}
					if(!(checkedRows[i].toLpnNumber == null || checkedRows[i].toLpnNumber == '')){
						cellTd2.addClass('datagrid-cell-edited');
					}
					if(!(checkedRows[i].toContainerNumber == null || checkedRows[i].toContainerNumber == '')){
						cellTd2.addClass('datagrid-cell-edited');
					}
					if(!(checkedRows[i].toQuantity == null || checkedRows[i].toQuantity == '')){
						cellTd2.addClass('datagrid-cell-edited');
					}
					
				}
				
		});
    });
    
</script>
</html>
