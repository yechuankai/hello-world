<!DOCTYPE html>
<html>
<head>
    <title wms:text="${web.lable.inventory.countrequest}">盘点请求</title>
    <head th:replace="common/head"/>
</head>
<body class="easyui-layout">
<div data-options="region:'west',collapsible:true" wms:title="${web.label.search.title}" style="width:200px;">
    <div id="searchDiv">
        <div style="margin-left: 10px;">
            <form id="searchForm" data-table="#requestData">
                <div style="margin-bottom:10px">
                    <input name="requestNumber" class="easyui-textbox" wms:data-options="label:'${web.label.requestnumber}',labelPosition:'top'" />
                </div>
                <div style="margin-bottom:10px">
                    <input class="easyui-combobox" name="requestType" wms:data-options="
						data: codelkups['COUNTTYPE'],
						valueField: 'code',
						textField: 'descr',
						label: '${web.label.type}',
						labelPosition: 'top'
						">
                </div>
                <div style="margin-bottom:10px">
                    <input class="easyui-combobox" name="quantityShowFlag" wms:data-options="
						data: codelkups['YESNO'],
						valueField: 'code',
						textField: 'descr',
						label: '${web.label.quantityshowflag}',
						labelPosition: 'top'
						">
                </div>
            </form>
        </div>
        <div style="text-align: center;">
            <a href="#" class="easyui-linkbutton common-search" data-form="#searchForm" style="width:80px;"
               data-options="iconCls:'icon-search'">
                <span wms:text="${web.label.search}">Search</span>
            </a>
            <a href="#" class="easyui-linkbutton common-search-clear" data-form="#searchForm" style="width:80px;"
               data-options="iconCls:'icon-clear'">
                <span wms:text="${web.label.clear}">Clear</span>
            </a>
        </div>
    </div>
</div>
<div data-options="region:'center',border:false" >
    <div class="tableToolbar">
        <a href="#" class="easyui-linkbutton common-add" data-addpanel="#addDiv">
            <span wms:text="${web.label.add}">Add</span>
        </a>
        <a href="#" class="easyui-linkbutton common-rowsave" data-table="#requestData" th:data-url="@{/services/inner/inventory/inventoryCount/requestSave}" >
            <span wms:text="${web.label.save}">Save</span>
        </a>
        <a href="#" class="easyui-linkbutton create_count" data-table="#requestData" th:data-url="@{/services/inner/inventory/inventoryCount/createCount}" >
            <span wms:text="${web.label.createcount}">createCount</span>
        </a>
        <a href="#" class="easyui-linkbutton common-rowdel"  data-table="#requestData" th:data-url="@{/services/inner/inventory/inventoryCount/requestDelete}">
            <span wms:text="${web.label.delete}">Delete</span>
        </a>
    </div>
    <div>
        <table id="requestData" wms:title="${web.label.requestlist}" class="easyui-datagrid"
               th:data-delayUrl="@{/services/inner/inventory/inventoryCount/findRequest}">
            <thead data-options="frozen:true">
            	<tr>
            		<th field="inventoryCountRequestId" data-options="checkbox:true"></th>
            		<th field="edit" data-options="
										formatter:function(value,row){
											var data = JSON.stringify(row);
											var detail = '<span title = \'编辑\' onclick=\'toEdit('+data+')\' class=\'icon-edit\'>&nbsp;</span>';
											return detail;
										}
									"></th>
            	</tr>
            </thead>
            <thead>
            <tr>
                <th field="requestNumber" width="120" wms:text="${web.label.requestnumber}" data-options="sortable:true">requestNumber</th>
                <th field="requestDescr" width="150" wms:text="${web.label.descr}" data-options="sortable:true,editor:'text'">requestDescr</th>
                <th field="ownerCode" width="100" wms:text="${web.label.owner}" wms:data-options="
                	sortable:true,
                	editor:{
                		type: 'combogrid',
	                		options: {
	                		idField:'ownerCode',
	  						textField:'ownerCode',
							url:'../../services/inner/base/owner/find',
							onBeforeLoad: function(param){
									$.extend(param, getBaseData());
								},
							 columns:[[
								    {field:'ownerCode',title:'${web.label.owner}',width:80},
								    {field:'ownerDescr',title:'${web.label.descr}',width:150}
							    ]]
						}
                	}
                ">owner</th>
                <!--  
                <th field="requestType" width="100" wms:text="${web.label.type}" data-options="
							sortable:true,
							formatter:function(value,row){
								return getCodelkupValue('COUNTTYPE',value);
							},
							editor:{
								type:'combobox',
								options:{
									valueField:'code',
									textField:'descr',
									data: codelkups['COUNTTYPE'],
									required: true
								}
							}
						" >requestType</th>
				-->
                <th field="quantityShowFlag" width="100" wms:text="${web.label.quantityshowflag}" data-options="
							sortable:true,
							formatter:function(value,row){
								return getCodelkupValue('YESNO',value);
							},
							editor:{
								type:'combobox',
								options:{
									valueField:'code',
									textField:'descr',
									data: codelkups['YESNO'],
									required: true
								}
							}
						" >quantityShowFlag</th>
                <th field="requestDate" width="150" wms:text="${web.label.requestdate}"  data-options="sortable:true">createTime</th>
                <th field="createBy" width="80" wms:text="${web.label.createby}">createBy</th>
                <th field="createTime" width="150" wms:text="${web.label.createtime}"  data-options="sortable:true">createTime</th>
                <th field="updateBy" width="80" wms:text="${web.label.updateby}" >updateBy</th>
                <th field="updateTime" width="150" wms:text="${web.label.updatetime}" data-options="sortable:true">updateTime</th>
            </tr>
            </thead>
        </table>
    </div>
</div>
<div id="addDiv" wms:title="${web.label.add}" style="width:700px;height:600px; display: none;">
    <div style="width: 100%;padding-left: 10px;">
        <form method="post" id="addForm" th:data-url="@{/services/inner/inventory/inventoryCount/addRequest}">
            <input type="hidden" name="inventoryCountRequestId" />
            <input type="hidden" name="updateVersion" />
            <table style="width: 100%;">
                <tr>
                    <td width="25%">
                        <input name="requestNumber" readonly="readonly" class="easyui-textbox" style="width: 96%;" wms:data-options="label:'${web.label.requestnumber}',labelPosition:'top'">
                    </td>
                    <td width="25%">
                        <input class="easyui-combobox" name="quantityShowFlag" style="width: 96%;" wms:data-options="
						data: codelkups['YESNO'],
						valueField: 'code',
						textField: 'descr',
						label: '${web.label.quantityshowflag}',
						labelPosition: 'top',
						value:'N',
						required: true
						">
                    </td>
                    <td width="25%">
                    	<input id="ownerCode" name="ownerCode" class="lazy-load" lazy-load="easyui-combogrid" style="width: 96%;" wms:data-options="
								label: '${web.label.owner}',
								labelPosition: 'top',
								idField:'ownerCode',
    							textField:'ownerCode',
								url:'../../services/inner/base/owner/find',
								onBeforeLoad: function(param){
									$.extend(param, getBaseData());
								},
							    columns:[[
								    {field:'ownerCode',title:'${web.label.owner}',width:80},
								    {field:'ownerDescr',title:'${web.label.descr}',width:150}
							    ]]
							" />
                    </td>
                    <td width="25%">
                    	&nbsp;
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <input name="requestDescr" style="width: 96%;" class="easyui-textbox"  wms:data-options="label:'${web.label.descr}',labelPosition:'top',required: true">
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <input id="fromZoneCode" name="fromZoneCode"  class="easyui-textbox" value="0" style="width: 96%;" wms:data-options="label:'${web.label.startzone}',labelPosition:'top'">
                    </td>
                    <td colspan="2">
                        <input id="toZoneCode" name="toZoneCode"  class="easyui-textbox" value="ZZZZZZZZZZ" style="width: 96%;" wms:data-options="label:'${web.label.endzone}',labelPosition:'top'">
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <input id="fromLocationCode" name="fromLocationCode"  class="easyui-textbox" value="0" style="width: 96%;" wms:data-options="label:'${web.label.startloc}',labelPosition:'top'">
                    </td>
                    <td colspan="2">
                        <input id="toLocationCode" name="toLocationCode"  class="easyui-textbox" value="ZZZZZZZZZZ" style="width: 96%;" wms:data-options="label:'${web.label.endloc}',labelPosition:'top'">
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <input id="fromSkuCode" name="fromSkuCode"  class="easyui-textbox" value="0" style="width: 96%;" wms:data-options="label:'${web.label.startsku}',labelPosition:'top'">
                    </td>
                    <td colspan="2">
                        <input id="toSkuCode" name="toSkuCode"  class="easyui-textbox" value="ZZZZZZZZZZ" style="width: 96%;" wms:data-options="label:'${web.label.endsku}',labelPosition:'top'">
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <input id="fromLpnNumber" name="fromLpnNumber"  class="easyui-textbox" style="width: 96%;" wms:data-options="label:'${web.label.startlpn}',labelPosition:'top'">
                    </td>
                    <td colspan="2">
                        <input id="toLpnNumber" name="toLpnNumber"  class="easyui-textbox" style="width: 96%;" wms:data-options="label:'${web.label.endlpn}',labelPosition:'top'">
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <input name="skuCodeIn" class="easyui-textbox" style="width: 96%;"  wms:data-options="label:'${web.label.skucodein}',labelPosition:'top'">
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <input name="lpnNumberIn" class="easyui-textbox" style="width: 96%;"  wms:data-options="label:'${web.label.lpnnumberin}',labelPosition:'top'">
                    </td>
                </tr>
            </table>
        </form>
    </div>
    <div style="text-align: center;margin-top: 10px;">
    	<a href="#" class="easyui-linkbutton request-save" data-form="#addForm" data-table="#requestData" id="submitsaveForm" data-options="iconCls:'icon-ok'" style="padding:5px 0px;width:80px;">
			<span style="font-size:14px;" wms:text="${web.label.save}">Save</span>
		</a>
		<a href="#" style="display: none;" class="common-confirmadd" data-form="#addForm" data-table="#requestData" id="submitaddForm" >Add</a>
        <a href="#" class="easyui-linkbutton" id="clearAddForm" onclick="$('#addForm').form('clear');"
           data-options="iconCls:'icon-clear'" style="padding:5px 0px;width:80px;">
            <span style="font-size:14px;" wms:text="${web.label.clear}">Clear</span>
        </a>
    </div>
</div>
</body>
<script th:replace="common/js"/>
<script type="text/javascript" th:src="@{/js/codelkupList?listName=COUNTTYPE,YESNO,LPNTYPE,LOCATIONTYPE,ZONETYPE}"></script>
<script type="text/javascript" th:inline="text">
    $(function () {
        $('.create_count').click(function () {
            var datagrid = $(this).attr('data-table');
            var url = $(this).attr('data-url');

            var checkedRows = $(datagrid).datagrid('getChecked');
            if (checkedRows.length != 1) {
                showError($.locale.selectOneRow);
                return;
            }
            var data = getBaseData(checkedRows[0]);
            loading();
            $.post({
                url: url,
                data: data,
                success: function (data) {
                    data = returnData(data);
                    closeLoading();
                    if (data.code == '0') {
                        showError(data.msg);
                    }else {
                        showMsg(data.msg);
                    }
                    $(datagrid).datagrid('reload').datagrid('clearChecked');
                }
            });
        });
        $('.request-save').click(function(){
    		if (addFlag){
    			$('.common-confirmadd').trigger('click');
    		}else{
    			save();
    		}
    	});
    });
    
    var editData;
    var addFlag = true;
    
    function toEdit(data) {
    	addFlag = false;
        if (typeof(data) == 'object') {
            editData = data;
        }else{
        	showError($.locale.selectOneRow);
        }
        var panel = '#addDiv';
        lazyLoadView(panel);
        $(panel).dialog({
            closed: true,
            modal: true,
            fix: true,
            buttons: '#editButton',
        }).dialog('open');
        $(panel).find('form').form('reset');
        var from = $(panel).find('form');
        $(from).form('load', editData);
        $('#lotValidateCode').textbox({readonly:true});
    }

    function save(){
    	var valid = $('#addForm').form('validate');
    	if (!valid) {
    		return;
    	}
    	var data = $('#addForm').serializeObject();
    	var dataArr = [data];
    	data = getBaseData(dataArr);
    	loading();
    	$.post({
    		url: '../../services/inner/inventory/inventoryCount/requestSave',
    		data:data,
    		success: function(data){
    			data = returnData(data);
    			closeLoading();
    			if (data.code == '0') {
    				showError(data.msg);
    				return;
    			}
    			$('#addForm').form('reset');
    			$('#addForm').parents('.window-body').dialog('close');
    			if ($('.common-search').length > 0){
    				$('.common-search').trigger('click');
    			}
    		}
    	});
    }
    
    
</script>
</html>