<!DOCTYPE html>
<html>
<head>
    <title wms:text="${wms.outbound.title}">出库单</title>
    <head th:replace="common/head" />
    <script th:replace="common/js" />
    <script type="text/javascript" th:src="@{/js/codelkupList?listName=OUTBOUNDSTATUS,OUTBOUNDTYPE,UOM}"></script>
    <script type="text/javascript" th:src="@{/static/js/outbound/outbound.js}"></script>
    <style>
        td{
            border:0px;
            padding: 0px;
            margin: 0px;
        }
        table {
            border-spacing: 0;
        }
    </style>
</head>
<body class="easyui-layout" style="opacity: 1;">
<div class="icon-loading" style="position: absolute; z-index: 999999;width: 100%; height: 100%;opacity: 1;background-color: white;" >&nbsp;</div>
<div data-options="region:'north',collapsible:false" style="height:35px;">
    <div class="tableToolbar">
        <a href="#" class="easyui-linkbutton outbound-new" onclick="window.location.reload();" >
				<span wms:text="${web.label.add}">New</span>
			</a>
        <a href="#" class="easyui-linkbutton outbound-save" data-form="#outboundHeaderForm" >
            <span wms:text="${web.label.save}">Save</span>
        </a>
        <a href="#" class="easyui-menubutton" data-options="menu:'#optionsMenuButton',plain:false" wms:text="${web.label.options}">Actions</a>
        <div id="optionsMenuButton">
            <div  wms:text="${web.label.allocate}" onclick="action('allocate')">Allocate</div>
            <div  wms:text="${web.label.unallocate}" onclick="action('unallocate')">Unallocate</div>
            <!-- <div  wms:text="${web.label.release}" onclick="action('release')">Release</div>-->
            <div  wms:text="${web.label.pick}" onclick="action('pick')">Pick</div>
            <div  wms:text="${web.label.unpick}" onclick="action('unpick')">Unpick</div>
        </div>
        <a href="#" class="easyui-menubutton" data-options="menu:'#optionsOutboundReport',plain:false" wms:text="${web.label.report}">Report</a>
        <div id="optionsOutboundReport">
            <div  wms:text="${wms.label.pickreport}" onclick="exportPDFReport('PICKLIST')">Allocate</div>
        </div>
        <a href="#" class="easyui-linkbutton" onclick="importExcel('OUTBOUND')" wms:text="${web.label.import}">Import</a>
        
    </div>
</div>
<div class="easyui-layout" data-options="region:'center',collapsible:false">
    <div data-options="region:'north',collapsible:false,split:true" wms:title="${web.label.outbound.header}" style="height: 300px;">
        <div th:replace="outbound/header" />
    </div>
    <div data-options="region:'center',border:false" >
        <div th:replace="outbound/detail" />
    </div>
</div>
</body>
<script type="text/javascript" th:inline="text">
	var headerData;
    lazyLoadView('#headerTab1');
    loadDetailListToolbarView();
    loadDetailListView();
    $(function(){
        $('.outbound-save').click(function(){
            var from = $(this).attr('data-form');
            var url = $(from).attr('data-url');
            var valid = $(from).form('validate');
            if (!valid) {
                return;
            }
            debugger;
            var detailData = getOutboundDetailChangeData(); // import function
            var headerData = getOutboundHeaderData(); // import function
            headerData['detail'] = detailData;
            var data = getBaseData(headerData);
            loading();
            $.post({
                url: url,
                data:data,
                success: function(data){
                    data = returnData(data);
                    closeLoading();
                    if (data.code == '0') {
                        showError(data.msg);
                        return;
                    }
                    refreshOutboundHeader(data.data);
                    refreshOutboundDetail(data.data);
                }
            });
        });
        setTimeout(function(){
            lazyLoadView('#addDetailDiv');
            lazyLoadView('#outboundHeaderForm');
        }, 1);
    });
    
    function action(type){
		headerData = getOutboundHeaderData();
		var checkedRows = [headerData];
		baseAction(type, checkedRows);
	}
	
	/* 导出文件  */
	function exportPDFReport(type) {
		headerData = getOutboundHeaderData();
		exportOutboundReport(type, headerData);
	}

</script>
</html>