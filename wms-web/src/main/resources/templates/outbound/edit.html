<!DOCTYPE html>
<html>
<head>
    <title wms:text="${wms.outbound.title}">出库单</title>
    <head th:replace="common/head" />
    <script th:replace="common/js" />
    <script type="text/javascript" th:src="@{/js/codelkupList?listName=OUTBOUNDSTATUS,OUTBOUNDTYPE,UOM}"></script>
    <style>
        td{
            border:0px;
            padding: 0px;
            margin: 0px;
        }
        table {
            border-spacing: 0;
        }
    </style>
</head>
<body class="easyui-layout" style="opacity: 1;">
<div class="icon-loading" style="position: absolute; z-index: 999999;width: 100%; height: 100%;opacity: 1;background-color: white;" >&nbsp;</div>
<div data-options="region:'north',collapsible:false" style="height:35px;">
    <div class="tableToolbar">
        <a href="#" class="easyui-linkbutton outbound-save" data-form="#outboundHeaderForm" >
            <span wms:text="${web.label.save}">Save</span>
        </a>
    </div>
</div>
<div class="easyui-layout" data-options="region:'center',collapsible:false">
    <div data-options="region:'north',collapsible:false,split:true" wms:title="${web.label.outbound.header}" style="height: 300px;">
        <div th:replace="outbound/header" />
    </div>
    <div data-options="region:'center',border:false" >
        <div th:replace="outbound/detail" />
    </div>
</div>
</body>
<script type="text/javascript" th:inline="text">
    lazyLoadView('#headerTab1');
    loadDetailListToolbarView();
    loadDetailListView();
    $(function(){
        $('.outbound-save').click(function(){
            var from = $(this).attr('data-form');
            var url = $(from).attr('data-url');
            var valid = $(from).form('validate');
            if (!valid) {
                return;
            }
            var detailData = getOutboundDetailChangeData(); // import function
            var headerData = getOutboundHeaderData(); // import function
            headerData['detail'] = detailData;
            var data = getBaseData(headerData);
            loading();
            $.post({
                url: url,
                data:data,
                success: function(data){
                    data = returnData(data);
                    closeLoading();
                    if (data.code == '0') {
                        showError(data.msg);
                        return;
                    }
                    refreshOutboundDetail(data.data);
                    $(panel).dialog('close');
                }
            });
        });
        setTimeout(function(){
            lazyLoadView('#addDetailDiv');
            lazyLoadView('#outboundHeaderForm');
        }, 1);
    });

</script>
</html>