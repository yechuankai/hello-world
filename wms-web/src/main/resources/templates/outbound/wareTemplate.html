<!DOCTYPE html>
<html>
<head>
    <title wms:text="${web.label.wave.template}">波次模板</title>
    <head th:replace="common/head" />
    <script th:replace="common/js" />
    <script type="text/javascript" th:src="@{/js/codelkupList?listName=YESNO,WAVETYPE,OUTBOUNDTYPE,OUTBOUNDSTATUS}"></script>
</head>
<body class="easyui-layout" style="opacity: 1;" >
	<div class="icon-loading" style="position: absolute; z-index: 999999;width: 100%; height: 100%;opacity: 1;background-color: white;" >&nbsp;</div>
	<div data-options="region:'west',collapsible:true" wms:title="${web.label.search.title}" style="width:200px;">
		<div id="searchDiv" class="easyui-layout" style="height: 100%;">
			<div style="margin-left: 10px;height: 100%;" data-options="region:'center',border:false" >
				<form id="waveSearchForm" data-table="#waveResult">
	                <div style="margin-bottom:10px">
	                    <input name="buildCode" class="easyui-textbox"
	                           wms:data-options="label:'${web.label.templateNumber}',labelPosition:'top'"/>
	                </div>
	            </form>
			</div>
			<div style="text-align: center;height:50px;" data-options="region:'south',border:false">
				<a href="#" class="easyui-linkbutton common-search " data-form="#waveSearchForm" style="width:80px;"
	               data-options="iconCls:'icon-search'">
	                <span wms:text="${web.label.search}">Search</span>
	            </a>
				<a href="#" class="easyui-linkbutton common-search-clear" data-form="#waveSearchForm" style="width:80px;" data-options="iconCls:'icon-clear'" >
					<span wms:text="${web.label.clear}">Clear</span>
				</a>
			</div>
				
		</div>
	</div>
	<div data-options="region:'center',border:false">
		<div class="easyui-layout" style="width: 100%;height: 100%;">
			<div data-options="region:'north',collapsible:false" style="height:35px;">
				<div class="tableToolbar">
    				<a href="#"  class="easyui-linkbutton" onclick="addDialog()"  wms:text="${web.label.add}">New</a>
    				<a href="#"  class="easyui-linkbutton"  wms:text="${web.label.save}">Save</a>
    				<a href="#"  class="easyui-linkbutton" onclick="searchOutbounds()"  wms:text="${web.label.queryOrder}">Search</a>
    				<a href="#"  class="easyui-linkbutton"  wms:text="${web.label.delete}">Delete</a>
				</div>
			</div>
			<div data-options="region:'center',collapsible:false,border:false" >
				<div class="easyui-layout" id="detailLayout" style="width: 100%;height: 100%;" data-options="fix:true">
					<div data-options="region:'center',collapsible:false,border:false" >
						<table id="waveResult" wms:title="${web.label.wave.template}" class="easyui-datagrid" th:data-delayUrl="@{/services/inner/waveTemplate/find}">
							<thead>
							    <th field="waveBuildId" data-options="checkbox:true"></th>
					            <th field="buildCode" width="90" wms:text="${web.label.templateNumber}">buildCode</th>
					            <th field="buildDescr" width="90" wms:text="${web.label.descr}">buildDescr</th>
					            <th field="createBy" width="90" wms:text="${web.label.createby}">creater</th>
					            <th field="createTime" width="90" wms:text="${web.label.createtime}">create time</th>
					            <th field="updateBy" width="90" wms:text="${web.label.updateby}">updater</th>
					            <th field="updateTime" width="90" wms:text="${web.label.updatetime}">update time</th>
				            </thead>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div id="addWaveTemplate" wms:title="${web.label.add}" style="width:690px;height:450px; display: none;">
	    <div style="width: 100%;padding-left: 50px;">
	        <form method="post" id="addForm" th:data-url="@{/services/inner/waveTemplate/add}">
	            <table style="width: 100%;">
	                <tr>
	                    <td>
	                        <input data-property="buildCode" class="easyui-textbox commit" wms:data-options="required:true,label:'${web.label.templateNumber}',labelPosition:'top'">
	                    </td>
	                    <td>
	                        <input data-property="wareType" class="easyui-combobox commit" wms:data-options="data: codelkups['WAVETYPE']
	                        ,valueField: 'code'
	                        ,textField: 'descr'
	                        ,required:true
	                        ,label:'${web.label.wareType}'
	                        ,labelPosition:'top'">
	                    </td>
	                    <td>
	                        <input data-property="buildDescr" class="easyui-textbox commit"  wms:data-options="label:'${web.label.descr}',labelPosition:'top'">
	                    </td>
	                </tr>
	                <tr>
	                	<td>
	                	<input data-type="list" data-condition="header" data-property="Type" data-expression="In" class="easyui-combobox commit" name="outboundTypes" wms:data-options="
							data: codelkups['OUTBOUNDTYPE'],
							valueField: 'code',
							textField: 'descr',
							label:'${web.label.outboud.contains}',
							labelPosition:'top',
							multiple: true,
							"/>
	                    </td>
	                	<td>
	                        <input data-type="date" data-condition="header" data-property="ExpectedOutboundDate" data-expression="GreaterThan" name="startDate" class="easyui-datebox commit"  wms:data-options="label:'${web.label.expectedoutbounddatebegin}',labelPosition:'top'">
	                    </td>
	                    <td>
	                        <input data-type="date" data-condition="header" data-property="ExpectedOutboundDate" data-expression="LessThan" name="endDate" class="easyui-datebox commit"  wms:data-options="label:'${web.label.expectedoutbounddateend}',labelPosition:'top'">
	                    </td>
	                </tr>
	                <tr>
	                    <td>
	                        <input id="owners" data-type="list" data-condition="header" data-property="OwnerCode" data-expression="In" name="owners" class="easyui-textbox commit"  wms:data-options="label:'${web.label.owner.contains}',labelPosition:'top',
								columns:[[
									{field:'ck',checkbox:true},
									{field:'ownerCode',title:'${web.inventory.ownerCode}',width:80},
									{field:'ownerDescr',title:'${web.label.descr}',width:150}
								]]">
	                    </td>
	         			<td>
	                        <input id="customers" data-type="list" data-condition="header" data-property="CustomerCode" data-expression="In" name="customers" class="easyui-textbox commit"  wms:data-options="label:'${web.label.customer.contains}',labelPosition:'top',
								columns:[[
									{field:'ck',checkbox:true},
									{field:'customerCode',title:'${web.label.customercode}',width:80},
								    {field:'customerDescr',title:'${web.label.descr}',width:150}
								]]">
	                    </td>
	                    <td>
	                    	<input id="carriers" class="easyui-textbox commit" data-type="list" data-condition="header" data-property="CarrierCode" data-expression="In" name="carriers" wms:data-options="label:'${web.label.carrier}',labelPosition:'top',
		                    	columns:[[
									{field:'ck',checkbox:true},
									{field:'carrierCode',title:'${web.label.carrier}',width:80},
									{field:'carrierDescr',title:'${web.label.descr}',width:150}
								]]"/>
	                    </td>
	                </tr>
	                <tr>
	                    <td>
	                        <input id="skus" data-type="list" data-condition="detail" data-property="getSkuCode" data-expression="In" name="skus" class="easyui-textbox commit"  wms:data-options="label:'${web.label.sku.contains}',labelPosition:'top',
								columns:[[
									{field:'ck',checkbox:true},
									{field:'skuCode',title:'${web.label.sku}',width:80},
								    {field:'skuAlias',title:'${web.label.skualias}',width:80}
								]]">
	                    </td>
	                </tr>
	                <tr>
	                    <td>
	                        <input data-type="decimal" data-condition="sum" data-property="getQuantityOrder" data-expression="1,0" name="startNumber" class="easyui-numberbox commit"  wms:data-options="label:'${web.label.quantityorder}',labelPosition:'top'">
	                    </td>
	                    <td>
	                        <input data-type="decimal" data-condition="sum" data-property="getQuantityOrder" data-expression="0,-1" name="endNumber" class="easyui-numberbox commit"  wms:data-options="label:' ',labelPosition:'top'">
	                    </td>
	                </tr>
	            </table>
	        </form>
	    </div>
	    <div style="text-align: center;margin-top: 15px;">
	        <a href="#" class="easyui-linkbutton" onclick="addWaveTemplate()" data-options="iconCls:'icon-ok'" style="padding:5px 0px;width:80px;">
	            <span style="font-size:14px;" wms:text="${web.label.save}">Save</span>
	        </a>
	        <a href="#" class="easyui-linkbutton" id="clearAddForm" onclick="$('#addForm').form('clear');" data-options="iconCls:'icon-clear'" style="padding:5px 0px;width:80px;">
	            <span style="font-size:14px;" wms:text="${web.label.clear}">Clear</span>
	        </a>
	    </div>
	</div>
	<div th:replace="outbound/searchByTemplate"/>
</body>
<script type="text/javascript" th:src="@{/static/ui/plugins/datagrid-filter.js}"></script>
<script type="text/javascript" th:inline="text"></script>
<script type="text/javascript">
	function addDialog(){
		$('#addWaveTemplate').dialog({}).dialog('open');
		carrierComboGrid("#carriers");
		skuComboGrid("#skus");
		lpnComboGrid("#lpns");
		customerComboGrid("#customers");
		ownerComboGrid("#owners");
	}
	
	function searchOutbounds(){
		var checkedRows = $('#waveResult').datagrid('getChecked');
		if (checkedRows.length != 1) {
			showError($.locale.selectOneRow);
			return;
		}
		var rowData = checkedRows[0];
		showById(rowData.waveBuildId);
	}
	
	/* 新增 */
	function addWaveTemplate(){
		var valid = $("#addForm").form('validate');
		if (!valid) {
			return;
		}
		var data = {waveBuildDetailTEntities:[]};
		$("#addForm .commit").each(function(i,e){
			if($(e).val()){
				if($(e).data("expression") && $(e).data("property")){
					var detail = {};
					detail.propertyValue1 = $(e).val();
					detail.propertyExp = $(e).data("expression");
					detail.propertyCode = $(e).data("property");
					detail.propertyType = $(e).data("type");
					detail.tableName = $(e).data("condition");
					data.waveBuildDetailTEntities.push(detail);
				}else{
					data[$(e).data("property")] = $(e).val();
				}
			}
		});
		var baseData = getBaseData();
		baseData.data = data;
		loading();
		$.post({
			url:getServiceUrl() + "/services/inner/waveTemplate/save",
			data:baseData,
			success:function(data){
				data = returnData(data);
                closeLoading();
                if (data.code == '0') {
                    showError(data.msg);
                    return;
                }
                $("#addForm").form('clear');
                $('#addWaveTemplate').dialog('close');
                $("#waveResult").datagrid('reload').datagrid('clearChecked');
			}
		});
	}
</script>
</html>
