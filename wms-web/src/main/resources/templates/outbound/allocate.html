<!DOCTYPE html>
<html>
<head>
    <title wms:text="${wms.allocate.title}">分配明细</title>
    <head th:replace="common/head"/>
</head>
<body class="easyui-layout">
<div data-options="region:'west',collapsible:true" wms:title="${web.label.search.title}" style="width:200px;">
    <div id="searchDiv" class="easyui-layout" style="height: 100%;">
        <div style="margin-left: 10px;height: 100%;" data-options="region:'north',border:false">
            <form id="searchForm" data-table="#dataTable">
                <div style="margin-bottom:10px">
                    <input name="sourceBillNumber" class="easyui-textbox"
                           wms:data-options="label:'${web.label.sourcebillnumber}',labelPosition:'top'">
                </div>
                <div style="margin-bottom:10px">
                    <input name="sourceLineNumber" class="easyui-numberbox"
                           wms:data-options="label:'${web.label.sourcelinenumber}',labelPosition:'top'">
                </div>
                <div style="margin-bottom:10px">
                    <input name="sourceWaveNumber" class="easyui-textbox"
                           wms:data-options="label:'${web.label.sourcewavenumber}',labelPosition:'top'">
                </div>
                <div style="margin-bottom:10px">
                    <input name="ownerCode" class="easyui-textbox"
                           wms:data-options="label:'${web.label.owner}',labelPosition:'top'">
                </div>
                <div style="margin-bottom:10px">
                    <input name="skuCode" class="easyui-textbox"
                           wms:data-options="label:'${web.label.sku}',labelPosition:'top'">
                </div>
                <div style="margin-bottom:10px">
                    <input name="skuAlias" class="easyui-textbox"
                           wms:data-options="label:'${web.label.skualias}',labelPosition:'top'">
                </div>
                <div style="margin-bottom:10px">
                    <input name="lotNumber" class="easyui-textbox"
                           wms:data-options="label:'${web.label.lotnumber}',labelPosition:'top'">
                </div>
                <div style="margin-bottom:10px">
                    <input name="zoneCode" class="easyui-textbox"
                           wms:data-options="label:'${web.label.zone}',labelPosition:'top'">
                </div>
                <div style="margin-bottom:10px">
                    <input name="locationCode" class="easyui-textbox"
                           wms:data-options="label:'${web.label.location}',labelPosition:'top'">
                </div>
                <div style="margin-bottom:10px">
                    <input name="lpnNumber" class="easyui-textbox"
                           wms:data-options="label:'${web.label.lpnnumber}',labelPosition:'top'">
                </div>
                <div style="margin-bottom:10px">
                    <input name="loadLpnNumber" class="easyui-textbox"
                           wms:data-options="label:'${web.label.loadlpnnumber}',labelPosition:'top'">
                </div>
                <div style="margin-bottom:10px">
                    <input class="easyui-combobox" name="status" wms:data-options="
						data: codelkups['ALLOCATESTATUS'],
						valueField: 'code',
						textField: 'descr',
						label: '${web.label.status}',
						labelPosition: 'top'
						" />
                </div>
                <div style="margin-bottom:10px">
                    <input class="easyui-combobox" name="fullLpnFlag" wms:data-options="
						data: codelkups['YESNO'],
						valueField: 'code',
						textField: 'descr',
						label: '${web.label.fulllpnflag}',
						labelPosition: 'top'
						"/>
                </div>
                <div style="margin-bottom:10px">
                    <input class="easyui-combobox" name="allocateType" wms:data-options="
						data: codelkups['ALLOCATESTRATEGYTYPE'],
						valueField: 'code',
						textField: 'descr',
						label: '${web.label.type}',
						labelPosition: 'top'
						">
                </div>
                <div style="margin-bottom:55px">
                    <input name="allocateStrategyCode" class="easyui-textbox"
                           wms:data-options="label:'${web.label.allocatestrategycode}',labelPosition:'top'">
                </div>
            </form>
        </div>
        <div style="text-align: center;height:50px;" data-options="region:'south',border:false">
            <a href="#" class="easyui-linkbutton common-search" data-form="#searchForm" style="width:80px;"
               data-options="iconCls:'icon-search'">
                <span wms:text="${web.label.search}">Search</span>
            </a>
            <a href="#" class="easyui-linkbutton common-search-clear" data-form="#searchForm" style="width:80px;"
               data-options="iconCls:'icon-clear'">
                <span wms:text="${web.label.clear}">Clear</span>
            </a>
        </div>
    </div>
</div>
<div data-options="region:'center',border:false">
	<div class="tableToolbar">
		<a href="#" class="easyui-linkbutton common-rowsave" data-table="#dataTable" th:data-url="@{/services/inner/outbound/allocate/save}" >
			<span wms:text="${web.label.save}">Save</span>
		</a>
		<a href="#" class="easyui-linkbutton pick" onclick="action('pick')">
			<span wms:text="${web.label.pick}">Pick</span>
		</a>
		<a href="#" class="easyui-linkbutton ship" onclick="action('ship')">
			<span wms:text="${web.label.ship}">Ship</span>
		</a>
        <a href="#" class="easyui-linkbutton" onclick="exportExcel('ALLOCATE', '#searchForm')" wms:text="${web.label.export}">Export</a>
		<a href="#" class="easyui-linkbutton common-rowdel"  data-table="#dataTable" th:data-url="@{/services/inner/outbound/allocate/delete}">
			<span wms:text="${web.label.delete}">Delete</span>
		</a>
	</div>
    <div>
        <table id="dataTable" wms:title="${web.label.allocate.title}" class="easyui-datagrid"
               th:data-delayUrl="@{/services/inner/outbound/allocate/find}">
            <thead data-options="frozen:true">
				<tr>
		            <th field="allocateId" data-options="checkbox:true"></th>
			 	</tr>
			 </thead>
            <thead>
            	<tr>
		            <th field="sourceBillNumber" width="100" wms:text="${web.label.sourcebillnumber}" data-options="sortable:true">
		                sourceBillNumber
		            </th>
		            <th field="sourceLineNumber" width="100" wms:text="${web.label.sourcelinenumber}" data-options="sortable:true">
		                sourceLineNumber
		            </th>
		            <th field="sourceWaveNumber" width="100" wms:text="${web.label.sourcewavenumber}" data-options="sortable:true">
		                sourceWaveNumber
		            </th>
		            <th field="allocateStrategyType" width="100" wms:text="${web.label.allocatestrategytype}" data-options="
		                            sortable:true,
		                            formatter:function(value,row){
										return getCodelkupValue('ALLOCATESTRATEGYTYPE',value);
									}
		                        ">allocateStrategyType
		            </th>
		            <th field="ownerCode" width="50" wms:text="${web.label.owner}">
		                ownerCode
		            </th>
		            <th field="skuCode" width="100" wms:text="${web.label.sku}">
		                skuCode
		            </th>
		            <th field="skuAlias" width="100" wms:text="${web.label.skualias}">
		                skuAlias
		            </th>
		             <th field="lotNumber" width="100" wms:text="${web.label.lotnumber}">
		                lotNumber
		            </th>
		             <th field="zoneCode" width="80" wms:text="${web.label.zone}">
		                zoneCode
		            </th>
		             <th field="locationCode" width="80" wms:text="${web.label.location}">
		                locationCode
		            </th>
		             <th field="lpnNumber" width="80" wms:text="${web.label.lpnnumber}">
		                lpnNumber
		            </th>
		             <th field="fullLpnFlag" width="85" wms:text="${web.label.fulllpnflag}" data-options="
		                            sortable:true,
		                            formatter:function(value,row){
										return getCodelkupValue('YESNO',value);
									}
		                        ">fullLpnFlag
		             </th>
		            <th field="quantityAllocated" width="50" wms:text="${web.label.quantity.allocated}" data-options="
		            	editor: {
		            		type: 'numberbox',
		            		options: {
		            			required: true
		            		}
		            	}
		            	">
		                quantityAllocated
		            </th>
		            <th field="loadLpnNumber" width="100" wms:text="${web.label.loadlpnnumber}">
		                loadLpnNumber
		            </th>
		            <th field="status" width="70" wms:text="${web.label.status}" data-options="
		                            sortable:true,
		                            formatter:function(value,row){
										return getCodelkupValue('ALLOCATESTATUS',value);
									}
		                        ">status
		            </th>
		            <th field="toLocationCode" width="80" wms:text="${web.label.tolocationcode}">
		                toLocationCode
		            </th>
		             <th field="allocateType" width="80" wms:text="${web.label.allocatetype}" data-options="
		                            sortable:true,
		                            formatter:function(value,row){
										return getCodelkupValue('ALLOCATETYPE',value);
									}
		                        ">allocateType
		            </th>
		            <th field="allocateStrategyCode" width="100" wms:text="${wms.allocateStrategy.title}">
		                allocateStrategyCode
		            </th>
		            <th field="createBy" width="80" wms:text="${web.label.createby}">createBy</th>
		            <th field="createTime" width="150" wms:text="${web.label.createtime}"
		                data-options="sortable:true">createTime
		            </th>
		            <th field="updateBy" width="80" wms:text="${web.label.updateby}">updateBy</th>
		            <th field="updateTime" width="150" wms:text="${web.label.updatetime}"
		                data-options="sortable:true">updateTime
		            </th>
		           </tr>
            </thead>
        </table>
    </div>
</div>
</body>
<script th:replace="common/js"/>
<script type="text/javascript" th:src="@{/js/codelkupList?listName=YESNO,ALLOCATESTRATEGYTYPE,ALLOCATESTATUS,ALLOCATETYPE}"></script>
<script type="text/javascript" th:inline="text">
	function checkChanges(){
		var rows = $('#dataTable').datagrid('getChanges');
		if (rows.length > 0){
			showError($.locale.saveFirst);
			return false;
		}
		return true;
	}
	
	function action(type){
		if (!checkChanges()){
			return;
		}
		var datagrid = $('#dataTable').attr('data-table');
		
		var checkedRows = $('#dataTable').datagrid('getChecked');
		if (checkedRows.length == 0) {
			showError($.locale.selectOneRow);
			return;
		}
		confirmMsg($.locale.lineConfirm,{type:type,row:checkedRows.length}, function(r){
			if (!r){
				return;
			}
			var data = getBaseData(checkedRows);
			loading();
			$.post({
				url: '../../services/inner/outbound/allocate/'+type,
				data:data,
				success: function(data){
					data = returnData(data);
					closeLoading();
					if (data.code == '0') {
						showError(data.msg);
						return;
					}
					$('#dataTable').datagrid('reload').datagrid('clearChecked');
				}
			});
		});
	}
</script>
</html>