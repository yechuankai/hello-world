<!DOCTYPE html>
<html>
<head>
    <title wms:text="${wms.inbound.title}">入库单</title>
    <head th:replace="common/head" />
    <script th:replace="common/js" />
    <script type="text/javascript" th:src="@{/js/codelkupList?listName=INBOUNDTYPE,INBOUNDSTATUS,LOCATIONTYPE,UOM}"></script>
	<script type="text/javascript" th:src="@{/static/ui/plugins/datagrid-filter.js}"></script>
	<script type="text/javascript" th:src="@{/static/js/inbound/inbound.js}"></script>
    <style>
    	td{
	    	border:0px;
	    	padding: 0px;
	    	margin: 0px;
    	}
    	table {
		    border-spacing: 0;
		}
    </style>
</head>
<body class="easyui-layout" style="opacity: 1;">
	<div class="icon-loading" style="position: absolute; z-index: 999999;width: 100%; height: 100%;opacity: 1;background-color: white;" >&nbsp;</div>
	<div data-options="region:'north',collapsible:false" style="height:35px;">
		<div class="tableToolbar">
			<a href="#" class="easyui-linkbutton inbound-new" onclick="window.location.reload();" >
				<span wms:text="${web.label.add}">New</span>
			</a>
			<a href="#" class="easyui-linkbutton inbound-save" data-form="#inboundHeaderForm" >
				<span wms:text="${web.label.save}">Save</span>
			</a>
			<a href="#" class="easyui-menubutton" data-options="menu:'#optionsMenuButton',plain:false" wms:text="${web.label.options}">Actions</a>
			<div id="optionsMenuButton">
				<div  wms:text="${web.label.receive.all}" onclick="action('receiveAll')">All Receive</div>
				<div  wms:text="${web.label.cancelreceive}" onclick="action('unReceive')">unReceive</div>
			</div>
			<a href="#" class="easyui-menubutton" data-options="menu:'#reportMenuButton',plain:false" wms:text="${web.label.report}">Report</a>
			<div id="reportMenuButton">
				<div  wms:text="${wms.label.receivereport}" onclick="exportPDFReport('INBOUND')">Receive Peport</div>
				<div  wms:text="${wms.label.receivedsummaryreport}" onclick="exportPDFReport('INBOUNDCONFIRM')">Receive Summary Report</div>
			</div>
			<a href="#" class="easyui-linkbutton" onclick="importExcel('INBOUND')" wms:text="${web.label.import}">Import</a>
		</div>
	</div>
	<div class="easyui-layout" data-options="region:'center',collapsible:false">
		<div data-options="region:'north',collapsible:false,split:true" wms:title="${web.label.inbound.heander}" style="height: 300px;">
			<div th:replace="inbound/header" />
		</div>
		<div data-options="region:'center',border:false" >
			<div th:replace="inbound/detail" />
		</div>
	</div>
</body>
<script type="text/javascript" th:inline="text">
	lazyLoadView('#headerTab1');
	loadDetailListToolbarView();
	loadDetailListView();
	$(function(){
		$('.inbound-save').click(function(){
			var from = $(this).attr('data-form');
			var url = $(from).attr('data-url');
			var valid = $(from).form('validate');
			if (!valid) {
				return;
			}
			var detailData = getInboundDetailChangeData(); // import function
			var headerData = getInboundHeaderData(); // import function
			headerData['detail'] = detailData;
			var data = getBaseData(headerData);
			loading();
			$.post({
				url: url,
				data:data,
				success: function(data){
					data = returnData(data);
					closeLoading();
					if (data.code == '0') {
						showError(data.msg);
						return;
					}
					refreshInboundHeader(data.data);
					refreshInboundDetail(data.data);
				}
			});
		});
		setTimeout(function(){
			lazyLoadView('#addDetailDiv');
			lazyLoadView('#inboundHeaderForm');
		}, 1);
	});
	
	function action(type){
		headerData = getInboundHeaderData();
		var checkedRows = [headerData];
		baseAction(type, checkedRows);
	}
	
	/* 导出文件  */
	function exportPDFReport(type) {
		headerData = getInboundHeaderData();
		if (type == 'INBOUND' && 
				!(headerData.status == '10' || headerData.status == '20')){
			showError($.locale.inboundNewStatusPrint);
			return;
		}
		exportInboundReport(type, headerData);
	}
	
</script>
</html>
